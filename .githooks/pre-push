#!/usr/bin/env bash
set -euo pipefail

# Run local CI checks before pushing.
# Skip with: SKIP_PRE_PUSH=1 git push

if [[ "${SKIP_PRE_PUSH:-}" == "1" ]]; then
  echo "SKIP_PRE_PUSH=1 set; skipping pre-push checks."
  exit 0
fi

echo "== pre-push: bundle check =="
bundle check >/dev/null || {
  echo "Bundler deps missing. Run: bundle install"
  exit 1
}

echo "== pre-push: tests (rspec) =="
bundle exec rspec

echo "== pre-push: lint (rubocop) =="
bin/rubocop

echo "== pre-push: scan_ruby (brakeman) =="
bin/brakeman --no-pager

if [ -f "ui/package.json" ]; then
  echo "== pre-push: UI tests (vitest) =="
  npm --prefix ui run test:run
fi

echo "âœ… pre-push checks passed."

